---
title: "解析サーバー環境構築"
emoji: "🙌"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["Supermicro", "解析サーバー", "環境構築"]
published: true
---

# はじめに
今回解析用PCを新しく組むことになり、その際にAMDのEPYCプロセッサを採用しました。しかし、その際にいくつかトラブルが発生したので、その概要と解決したものについては解決方法を書いていきます。

使用機材は以下のとおりです。なおサーバー構築に関しては初心者であるため、記載内容については温かい目で見ていただけると幸いです。

- マザーボード: Supermicro H12DSi-NT6
- CPU: AMD EPYC 7C13 (Gigazineさんの記事で少し話題になっていたものです)
- メモリ: SK Hynix DDR4 2666 MHz 64GB (01RMSK2666V64GE) × 8
- SSD: Samsung 990 Pro 4TB
- GPU: NVIDIA RTX 3070
- 電源: NZXT C1200 Gold PA-2G1BB-JP
- CPUクーラー: Noctua NH-U14S TR4-SP3
- OS: Windows 11 Pro

# `No Media Present`の表示
起動時に`No Media Present`が表示され、Bootデバイスが一見するとないように見える状態でした。結果としてUEFI Shellから以下の手順でコマンドを実行しました。

1. `map`コマンドでデバイスを確認
1. `FS`(ファイルシステムの略)が付いているデバイスを探す
    - 例として、`FS0`や`FS1`など (以下は`FS0`の場合)とします
1. shellに`fs0:`と入力して、さらに`ls`コマンドでデバイス内のファイルを確認
1. `EFI`ディレクトリがあれば正解。`EFI\BOOT\BOOTX64.EFI`をコマンドに入力して実行する

# Windows起動後
Windowsインストール後はLanのドライバが入っていないため、アップデートや認証を行うことができません。そのため、別のPCからドライバをダウンロードしました。ダウンロード先はこちらです。

@[card](https://www.supermicro.com/ja/support/resources/downloadcenter/swdownload)

順序としては、Windowsでアップデートを掛ける前に、上記のサイトから`SP3_IO_Driver`と`Broadcom_10G_v216.0.4.1`のみをまずインストールし、その後Windows Updateを行ったほうがいいように思います。(順序を逆にしてしまったため、フリーズとブルスク(BAD_POOL_CALLER)が発生しました)

# マザーボード上のLED2の点滅(未解決)
起動時からLED2 (Overheat/Fan Failure LED)が点滅している状態です。REDDITの[こちら](https://www.reddit.com/r/homelab/comments/f04028/blinking_led_on_my_supermicro_h11dsint_and_cpu/?rdt=38278)の記事によると、Noctuaとの相性問題であるとのことです。

@[card](https://www.reddit.com/r/homelab/comments/f04028/blinking_led_on_my_supermicro_h11dsint_and_cpu/?rdt=38278)

基本的に上記のリンクの手順に沿って行えば、解決されるはずのですが、現時点でもLEDは点滅状態です。CPUの温度は正常です。また途中で必要なIMPIのパスワードは、デフォルトの状態からマザーボード上に記載へ変更となったようです。

## impiutilの引数の意味
上記のリンクでは以下のコマンドを入力しています。

```cmd
ipmiutil sensor -N IP -U ADMIN -P PASS -n SNum -u 100:100:100:25400:25400:25500
```

この最後の6つの数字の意味が不明でしたので、調べてみます。以下は[こちら](https://ipmiutil.sourceforge.net/)のサイトからの引用です。
> -u    Set  unique  threshold  values.	The values are specified in a string of threshold values.  It can be in raw hex characters or in float values.  All 6 possible thresholds must be specified, but only the ones that are valid for this sensor will be applied. These values are validated for ordering.  For example:
>     -u 6:5:4:60:65:69 (float) or
>     -u 0x0605043c4145 (raw hex)
>     would mean 0x06=noncrit_lo, 0x05=crit_lo, 0x04=nonrec_lo, 0x3c=noncrit_hi, 0x41=crit_hi, 0x45=nonrec_hi.

`float`あるいは`raw hex`で指定することがでるので、単位は温度かRPMでしょうか...?
- nonrec_lo: lower bound of non-recordable range or non-recoverable range?

## TODO
- 冷却ファンの交換

# 一部のUSBポートが認識されない(未解決)
認識されないUSBポートがあります。
- バックパネルのUSB2.0ポート
- フロントパネルのUSB3.0ポート

## TODO
- BIOSの更新
- OSをUbuntuに変更→Windows用のドライバが原因の可能性

# SSDのS.M.A.R.T.エラー (未解決)
何日か後に、起動直後に`smart status bad`が表示されるようになりました。

## GParted Liveで確認
Gparted LiveでS.M.A.R.T.情報の確認を行います。Rufus等でブート可能なUSBメモリを作成し、起動後に`smartctl -a /dev/sda`を実行します。

## TODO
- SSDのみを取り外して、他のPCで確認
    - 温度がしきい値を上回った？
        - ヒートシンク付属のSSDに交換
    - ファームウェアの更新

# Bootドライブで起動後に画面が表示されない
Gparted LiveやUbuntuのインストール用ブートメディアを挿入しても、画面が表示されなくなりました。

## TODO
- GPUの取り外しとVGA出力
    - VGA入力が可能なディスプレイを用意
